---
---

<div class="relative w-full max-w-2xl mx-auto">
  <div class="relative">
    <input
      type="text"
      id="plant-search"
      placeholder="Search plants by common or scientific name..."
      class="w-full px-6 py-4 text-lg border-2 border-sage-300 rounded-xl focus:outline-none focus:border-sage-500 focus:ring-2 focus:ring-sage-200 transition-all"
      autocomplete="off"
    />
    <svg
      class="absolute right-4 top-1/2 -translate-y-1/2 w-6 h-6 text-sage-400"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
      />
    </svg>
  </div>

  <div
    id="search-results"
    class="absolute z-50 w-full mt-2 bg-white border-2 border-sage-200 rounded-xl shadow-xl hidden max-h-96 overflow-y-auto"
  >
  </div>
</div>

<script>
  const searchInput = document.getElementById('plant-search') as HTMLInputElement;
  const searchResults = document.getElementById('search-results') as HTMLDivElement;
  let searchIndex: any[] = [];

  async function loadSearchIndex() {
    try {
      const response = await fetch('/data/search_index.json');
      searchIndex = await response.json();
    } catch (error) {
      console.error('Failed to load search index:', error);
    }
  }

  function performSearch(query: string) {
    if (!query.trim()) {
      searchResults.classList.add('hidden');
      return;
    }

    const lowercaseQuery = query.toLowerCase();
    const results = searchIndex
      .filter(plant =>
        plant.common_name.toLowerCase().includes(lowercaseQuery) ||
        plant.scientific_name.toLowerCase().includes(lowercaseQuery)
      )
      .slice(0, 10);

    if (results.length === 0) {
      searchResults.innerHTML = '<div class="p-4 text-gray-500 text-center">No plants found</div>';
      searchResults.classList.remove('hidden');
      return;
    }

    searchResults.innerHTML = results
      .map(plant => `
        <a
          href="/plant/${plant.id}"
          class="flex items-center gap-4 p-4 hover:bg-sage-50 transition-colors border-b border-sage-100 last:border-b-0"
        >
          <img
            src="${plant.thumbnail}"
            alt="${plant.common_name}"
            class="w-16 h-16 object-cover rounded-lg"
            loading="lazy"
          />
          <div class="flex-1">
            <div class="font-semibold text-gray-900">${plant.common_name}</div>
            <div class="text-sm text-gray-500 italic">${plant.scientific_name}</div>
          </div>
        </a>
      `)
      .join('');

    searchResults.classList.remove('hidden');
  }

  let debounceTimer: ReturnType<typeof setTimeout>;
  searchInput?.addEventListener('input', (e) => {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
      performSearch((e.target as HTMLInputElement).value);
    }, 200);
  });

  document.addEventListener('click', (e) => {
    if (!searchInput?.contains(e.target as Node) && !searchResults?.contains(e.target as Node)) {
      searchResults?.classList.add('hidden');
    }
  });

  loadSearchIndex();
</script>
